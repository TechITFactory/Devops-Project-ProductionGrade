# S4.2 UI Guide: Configure EKS Access with SSO (AWS Console)

> **This is the UI/Console version of S4.2.** For CLI commands, see [S4.2_EKS_ACCESS.md](./S4.2_EKS_ACCESS.md)

---

## Overview

| Step | AWS Console Location |
|------|---------------------|
| 1-4 | IAM Identity Center → Users & Groups |
| 5-7 | IAM Identity Center → Permission Sets |
| 8-9 | EKS Console → Access Tab |
| 10 | kubectl (CLI only) |

---

## Part 1: Create SSO Groups

### Step 1.1: Navigate to IAM Identity Center
1. Go to **AWS Console** → Search **"IAM Identity Center"**
2. Click **Groups** in the left sidebar
3. Click **Create group**

### Step 1.2: Create Platform-Admins Group
- **Group name:** `Platform-Admins`
- **Description:** `Full EKS cluster admin access`
- Click **Create group**

### Step 1.3: Create Developers Group
- **Group name:** `Developers`
- **Description:** `Developer namespace admin access`
- Click **Create group**

### Step 1.4: Create Developers-ReadOnly Group
- **Group name:** `Developers-ReadOnly`
- **Description:** `Read-only cluster access`
- Click **Create group**

---

## Part 2: Create Demo Users

### Step 2.1: Navigate to Users
1. In IAM Identity Center, click **Users** in the left sidebar
2. Click **Add user**

### Step 2.2: Create Dev Lead User
- **Username:** `devlead`
- **Email:** `devlead@techitfactory.local`
- **First name:** `Dev`
- **Last name:** `Lead`
- **Display name:** `Dev Lead`
- Click **Next** → **Add user**

### Step 2.3: Create Junior Developer User
- **Username:** `devjunior`
- **Email:** `devjunior@techitfactory.local`
- **First name:** `Junior`
- **Last name:** `Developer`
- **Display name:** `Junior Developer`
- Click **Next** → **Add user**

---

## Part 3: Add Users to Groups

### Step 3.1: Add Admin to Platform-Admins
1. Go to **Groups** → Click **Platform-Admins**
2. Click **Add users**
3. Select your admin user (e.g., `jaiadmin`)
4. Click **Add users**

### Step 3.2: Add Dev Lead to Developers
1. Go to **Groups** → Click **Developers**
2. Click **Add users**
3. Select `devlead`
4. Click **Add users**

### Step 3.3: Add Junior to Developers-ReadOnly
1. Go to **Groups** → Click **Developers-ReadOnly**
2. Click **Add users**
3. Select `devjunior`
4. Click **Add users**

---

## Part 4: Create Permission Sets

### Step 4.1: Navigate to Permission Sets
1. In IAM Identity Center, click **Permission sets** in the left sidebar
2. Click **Create permission set**

### Step 4.2: Create EKS-Platform-Admin
1. Select **Create a custom permission set**
2. Click **Next**
3. **Permission set name:** `EKS-Platform-Admin`
4. **Description:** `Full EKS cluster admin access`
5. **Session duration:** `8 hours`
6. Click **Next**

**Add Inline Policy:**
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "eks:DescribeCluster",
        "eks:ListClusters"
      ],
      "Resource": "*"
    }
  ]
}
```
7. Click **Next** → **Create**

### Step 4.3: Create EKS-Developer
- Same steps as above with:
- **Name:** `EKS-Developer`
- **Description:** `EKS developer namespace access`
- Same inline policy

### Step 4.4: Create EKS-ReadOnly
- Same steps with:
- **Name:** `EKS-ReadOnly`
- **Description:** `EKS read-only access`
- Same inline policy

---

## Part 5: Assign Permission Sets to Groups

### Step 5.1: Navigate to AWS Accounts
1. In IAM Identity Center, click **AWS accounts** in the left sidebar
2. Select your AWS account
3. Click **Assign users or groups**

### Step 5.2: Assign Platform-Admins
1. Select **Groups** tab
2. Check **Platform-Admins**
3. Click **Next**
4. Select **EKS-Platform-Admin** permission set
5. Click **Next** → **Submit**

### Step 5.3: Assign Developers
1. Click **Assign users or groups** again
2. Select **Groups** tab → Check **Developers**
3. Click **Next**
4. Select **EKS-Developer** permission set
5. Click **Next** → **Submit**

### Step 5.4: Assign Developers-ReadOnly
1. Click **Assign users or groups** again
2. Select **Groups** tab → Check **Developers-ReadOnly**
3. Click **Next**
4. Select **EKS-ReadOnly** permission set
5. Click **Next** → **Submit**

---

## Part 6: Configure EKS Access Mode

### Step 6.1: Navigate to EKS
1. Go to **AWS Console** → Search **"EKS"**
2. Click your cluster (**techitfactory-dev**)

### Step 6.2: Update Authentication Mode
1. Click **Access** tab
2. Click **Manage access**
3. Select **EKS API and ConfigMap**
4. Click **Save changes**

---

## Part 7: Create EKS Access Entries

### Step 7.1: Navigate to Access Entries
1. In your EKS cluster, click **Access** tab
2. Click **Create access entry**

### Step 7.2: Add Platform-Admin Entry
1. **IAM principal ARN:** Search and select `AWSReservedSSO_EKS-Platform-Admin_*`
2. **Type:** `Standard`
3. Click **Next**
4. Click **Add policy**
5. Select **AmazonEKSClusterAdminPolicy**
6. **Access scope:** `Cluster`
7. Click **Next** → **Create**

### Step 7.3: Add Developer Entry
1. Click **Create access entry**
2. **IAM principal ARN:** Select `AWSReservedSSO_EKS-Developer_*`
3. **Type:** `Standard`
4. **Kubernetes groups:** Add `developers`
5. Click **Next** → Skip policies → **Create**

### Step 7.4: Add ReadOnly Entry
1. Click **Create access entry**
2. **IAM principal ARN:** Select `AWSReservedSSO_EKS-ReadOnly_*`
3. **Type:** `Standard`
4. **Kubernetes groups:** Add `developers-readonly`
5. Click **Next**
6. Click **Add policy** → Select **AmazonEKSViewPolicy**
7. **Access scope:** `Cluster`
8. Click **Next** → **Create**

---

## Part 8: Create Kubernetes RBAC (CLI Required)

> ⚠️ This step requires kubectl - cannot be done in UI

```bash
kubectl apply -f k8s-manifests/rbac/sso-rbac.yaml
```

Or apply manually:
```bash
# Create dev namespace
kubectl create namespace dev

# Apply RBAC
cat << 'EOF' | kubectl apply -f -
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: developer-readonly
rules:
- apiGroups: ["", "apps"]
  resources: ["pods", "services", "deployments"]
  verbs: ["get", "list", "watch"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: developers-readonly-binding
subjects:
- kind: Group
  name: developers-readonly
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: developer-readonly
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: namespace-admin
  namespace: dev
rules:
- apiGroups: ["", "apps", "batch"]
  resources: ["*"]
  verbs: ["*"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: developers-admin-binding
  namespace: dev
subjects:
- kind: Group
  name: developers
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: Role
  name: namespace-admin
  apiGroup: rbac.authorization.k8s.io
EOF
```

---

## Part 9: Verification

### In AWS Console:
1. **IAM Identity Center** → **Groups** → Verify 3 groups with users
2. **IAM Identity Center** → **Permission sets** → Verify 3 permission sets
3. **IAM** → **Roles** → Search `AWSReservedSSO_EKS` → Verify 3 roles
4. **EKS** → **Access** → Verify 3 access entries

### In kubectl:
```bash
kubectl get clusterrole developer-readonly
kubectl get clusterrolebinding developers-readonly-binding
kubectl get role -n dev
kubectl get rolebinding -n dev
```

---

## Quick Reference: Console URLs

| Service | Direct URL |
|---------|-----------|
| IAM Identity Center | `https://ap-south-1.console.aws.amazon.com/singlesignon/home` |
| EKS Console | `https://ap-south-1.console.aws.amazon.com/eks/home` |
| IAM Roles | `https://console.aws.amazon.com/iam/home#/roles` |

---

## Summary: UI vs CLI

| Task | Easier in... |
|------|-------------|
| Creating Groups/Users | ✅ UI |
| Creating Permission Sets | ✅ UI |
| Viewing Access Entries | ✅ UI |
| Applying RBAC | ✅ CLI |
| Bulk Operations | ✅ CLI |
| Automation/IaC | ✅ CLI/Terraform |
