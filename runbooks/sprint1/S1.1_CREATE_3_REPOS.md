# Sprint 1, Story 1.1: Create 3 Production Repos

## Story Summary
Create the 3-repo structure for production-grade DevOps:
- `techitfactory-infra` → Terraform
- `techitfactory-app` → Microservices
- `techitfactory-gitops` → ArgoCD Manifests

---

## Prerequisites
- GitHub account with organization `TechITFactory`
- Git configured locally
- Terminal ready

---

## Part 1: Create techitfactory-infra Repo

### Step 1.1: Create GitHub Repo
```bash
# Go to GitHub → New Repository
# Name: techitfactory-infra
# Visibility: Public
# Do NOT initialize with README (we'll push our own)
```

### Step 1.2: Clone and Setup Structure
```bash
# Clone the empty repo
git clone https://github.com/TechITFactory/techitfactory-infra.git
cd techitfactory-infra

# Create folder structure
mkdir -p bootstrap
mkdir -p modules/vpc
mkdir -p modules/eks
mkdir -p environments/dev
mkdir -p environments/prod
mkdir -p .github/workflows
```

### Step 1.3: Create README.md
```bash
cat > README.md << 'EOF'
# TechIT Factory - Infrastructure

Terraform code for AWS infrastructure.

## Structure

```
├── bootstrap/          # S3 state, DynamoDB lock, KMS
├── modules/
│   ├── vpc/           # VPC, subnets, NAT
│   └── eks/           # EKS cluster, node groups
├── environments/
│   ├── dev/           # Dev environment
│   └── prod/          # Prod environment
└── .github/workflows/ # Terraform CI/CD
```

## Branching Model
- `main` → Protected, requires PR
- Feature branches → Short-lived, <1 day

## Quick Start

```bash
# Dev environment
cd environments/dev
terraform init
terraform plan
terraform apply
```
EOF
```

### Step 1.4: Create .gitignore
```bash
cat > .gitignore << 'EOF'
# Terraform
*.tfstate
*.tfstate.*
.terraform/
.terraform.lock.hcl
*.tfvars
!*.tfvars.example
crash.log
override.tf
override.tf.json
*_override.tf
*_override.tf.json

# IDE
.idea/
.vscode/
*.swp

# OS
.DS_Store
Thumbs.db
EOF
```

### Step 1.5: Create CODEOWNERS
```bash
cat > CODEOWNERS << 'EOF'
# Infrastructure team owns everything
* @TechITFactory/infra-team

# Security review for IAM changes
modules/*/iam*.tf @TechITFactory/security-team
bootstrap/ @TechITFactory/security-team
EOF
```

### Step 1.6: Create PR Template
```bash
mkdir -p .github
cat > .github/pull_request_template.md << 'EOF'
## Description
<!-- What does this PR do? -->

## Type of Change
- [ ] New infrastructure
- [ ] Infrastructure modification
- [ ] Bug fix
- [ ] Documentation

## Terraform Plan Output
```
<!-- Paste terraform plan output here -->
```

## Checklist
- [ ] `terraform fmt` passed
- [ ] `terraform validate` passed
- [ ] No sensitive values in code
- [ ] Variables documented
EOF
```

### Step 1.7: Create Placeholder Files
```bash
# Bootstrap placeholder
cat > bootstrap/main.tf << 'EOF'
# Terraform Bootstrap - S3 + DynamoDB + KMS
# This will be implemented in Story 2.1
EOF

# VPC module placeholder
cat > modules/vpc/main.tf << 'EOF'
# VPC Module
# This will be implemented in Story 3.1
EOF

# EKS module placeholder
cat > modules/eks/main.tf << 'EOF'
# EKS Module
# This will be implemented in Story 4.1
EOF

# Dev environment placeholder
cat > environments/dev/main.tf << 'EOF'
# Dev Environment
# This will be implemented after modules are ready
EOF
```

### Step 1.8: Commit and Push
```bash
git add .
git commit -m "Initial infra repo structure"
git push origin main
```

---

## Part 2: Create techitfactory-app Repo

### Step 2.1: Create GitHub Repo
```bash
# Go to GitHub → New Repository
# Name: techitfactory-app
# Visibility: Public
```

### Step 2.2: Clone and Setup Structure
```bash
cd ..
git clone https://github.com/TechITFactory/techitfactory-app.git
cd techitfactory-app

# Create folder structure
mkdir -p services/frontend
mkdir -p services/product
mkdir -p services/cart
mkdir -p services/order
mkdir -p charts
mkdir -p .github/workflows
```

### Step 2.3: Create README.md
```bash
cat > README.md << 'EOF'
# TechIT Factory - Application

Microservices monorepo for e-commerce platform.

## Structure

```
├── services/
│   ├── frontend/      # React SPA
│   ├── product/       # Product catalog (Node.js)
│   ├── cart/          # Shopping cart (Node.js)
│   └── order/         # Order processing (Python)
├── charts/            # Helm charts
└── .github/workflows/ # CI/CD per service
```

## Service Contracts
All services MUST expose:
- `GET /health` → Liveness probe
- `GET /ready` → Readiness probe

## Coming in Sprint 4
- Service implementation
- Dockerfiles
- Helm charts
EOF
```

### Step 2.4: Create .gitignore
```bash
cat > .gitignore << 'EOF'
# Dependencies
node_modules/
__pycache__/
*.pyc
.venv/

# Build
dist/
build/
*.egg-info/

# IDE
.idea/
.vscode/
*.swp

# Environment
.env
.env.local
*.env

# OS
.DS_Store
Thumbs.db

# Docker
*.log
EOF
```

### Step 2.5: Create CODEOWNERS
```bash
cat > CODEOWNERS << 'EOF'
# App team owns services
services/ @TechITFactory/app-team

# Platform team owns Helm charts
charts/ @TechITFactory/platform-team
EOF
```

### Step 2.6: Create Service Placeholders
```bash
# Frontend placeholder
cat > services/frontend/README.md << 'EOF'
# Frontend Service
React SPA - Will be implemented in Sprint 4
EOF

# Product service placeholder
cat > services/product/README.md << 'EOF'
# Product Service
Node.js Express API - Will be implemented in Sprint 4
EOF

# Cart service placeholder
cat > services/cart/README.md << 'EOF'
# Cart Service
Node.js Express API - Will be implemented in Sprint 4
EOF

# Order service placeholder
cat > services/order/README.md << 'EOF'
# Order Service
Python Flask API - Will be implemented in Sprint 4
EOF
```

### Step 2.7: Commit and Push
```bash
git add .
git commit -m "Initial app repo structure"
git push origin main
```

---

## Part 3: Create techitfactory-gitops Repo

### Step 3.1: Create GitHub Repo
```bash
# Go to GitHub → New Repository
# Name: techitfactory-gitops
# Visibility: Public
```

### Step 3.2: Clone and Setup Structure
```bash
cd ..
git clone https://github.com/TechITFactory/techitfactory-gitops.git
cd techitfactory-gitops

# Create folder structure
mkdir -p apps/platform
mkdir -p apps/services
mkdir -p environments/dev
mkdir -p environments/prod
```

### Step 3.3: Create README.md
```bash
cat > README.md << 'EOF'
# TechIT Factory - GitOps

ArgoCD Application manifests - Single Source of Truth for cluster state.

## Structure

```
├── apps/
│   ├── platform/      # ArgoCD, Prometheus, Loki, Grafana
│   └── services/      # App Helm releases
├── environments/
│   ├── dev/           # Dev values overrides
│   └── prod/          # Prod values overrides
└── app-of-apps.yaml   # Root ArgoCD application
```

## How It Works
1. ArgoCD watches this repo
2. Changes here = Changes in cluster
3. Git history = Audit log

## Promotion Model
- Merge to `main` → Deploys to `dev` (auto-sync)
- Git Tag/Release → Deploys to `prod` (manual sync)

## Rollback
```bash
git revert <commit>
git push
# ArgoCD auto-syncs the rollback
```
EOF
```

### Step 3.4: Create CODEOWNERS
```bash
cat > CODEOWNERS << 'EOF'
# Platform team owns platform apps
apps/platform/ @TechITFactory/platform-team

# App team can update service releases
apps/services/ @TechITFactory/app-team

# Prod requires additional review
environments/prod/ @TechITFactory/platform-team @TechITFactory/leads
EOF
```

### Step 3.5: Create App-of-Apps Placeholder
```bash
cat > app-of-apps.yaml << 'EOF'
# ArgoCD App-of-Apps
# This will be implemented in Sprint 3 (Epic 6)
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: platform-root
  namespace: argocd
spec:
  project: default
  source:
    repoURL: https://github.com/TechITFactory/techitfactory-gitops.git
    targetRevision: main
    path: apps
  destination:
    server: https://kubernetes.default.svc
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
EOF
```

### Step 3.6: Commit and Push
```bash
git add .
git commit -m "Initial gitops repo structure"
git push origin main
```

---

## Verification

### Check All Repos Created
```bash
# List repos
ls -la ~/techitfactory/
# Should show: techitfactory-infra, techitfactory-app, techitfactory-gitops

# Verify each has .git
ls -la techitfactory-infra/.git
ls -la techitfactory-app/.git
ls -la techitfactory-gitops/.git
```

### Check GitHub
- Visit https://github.com/TechITFactory
- Should see all 3 repos with initial commits

---

## Story Completion Checklist
- [ ] techitfactory-infra created with structure
- [ ] techitfactory-app created with structure
- [ ] techitfactory-gitops created with structure
- [ ] All repos have README.md
- [ ] All repos have .gitignore
- [ ] All repos have CODEOWNERS
- [ ] All repos pushed to GitHub
